<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<script type="text/javascript">
var userAgent = navigator.userAgent.toLowerCase();
var browser = 
	(browser = userAgent.match(/qqbrowser\/([\d.]+)/))?"qqbrowser/"+browser[1]:
	(browser = userAgent.match(/se\s+2.x/))?"sogou/2.x": //sougou
	(browser = userAgent.match(/msie\s+([\d.]+)/))?"msie/"+browser[1]: //ie
	(browser = userAgent.match(/chrome\/([\d.]+)/))?"chrome/"+browser[1]: //chrome
	(browser = userAgent.match(/firefox\/([\d.]+)/))?"firefox/"+browser[1]: //firefox
	(browser = userAgent.match(/version\/([\d.]+)\s+safari\/([\d.]+)/))?"safari/"+browser[1]: //safari
	(browser = userAgent.match(/opera\/([\d.]+)([\w\W]+)version\/([\d.]+)/))?"opera/"+browser[3]: //opera
	"other browser";
	var browser4 = browser.substr(0,2);
//实现回到页面顶部  
function goTopEx(){  
	var obj=document.getElementById("goTopBtn"); 
	var obj2=document.getElementById("shangy"); 
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");  
	
	function getScrollTop(){  
		if(browser4=="ch"){
			//chrome
			//chrome63.0.3239.132对DTD XHTML 1.0不再支持body.scrollTop属性，只支持documentElement.scrollTop 
			return document.documentElement.scrollTop; 
		}else{
			//IE、firefox
			return document.documentElement.scrollTop;  
		}  
	}
	function setScrollTop(value){ 
		if(browser4=="ch"){ 
			//chrome
			document.documentElement.scrollTop=value; 
		}else{  
			//IE、firefox
			document.documentElement.scrollTop=value;  
		} 
	}     
	window.onscroll=function(){getScrollTop()>50?obj.style.display="":obj.style.display="none";
	getScrollTop()>100?obj2.style.display="":obj2.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj3.style.display="":obj3.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj4.style.display="":obj4.style.display="none";
	}  
	obj.onclick=function(){  
		var goTop=setInterval(scrollMove,10);  
		function scrollMove(){  
				setScrollTop(getScrollTop()/1.1);  
				if(getScrollTop()<1)clearInterval(goTop);  
		}  
	}  
}  
function downn(){
	if(browser4=="ch"){
		//chrome
		window.scrollBy(0,document.body.clientHeight);
	}else{
		//IE、firefox
		window.scrollBy(0,document.documentElement.clientHeight*1000); 
	}
}
</script>
<script>
function changePage(){ 
	var page = document.getElementById("container");
	page.style.background="black";
	page.style.color="white";
	page.style.fontSize="22px";
	page.style.fontFamily="MV boli";
}
document.write('<div style="position:fixed; right: 10px; top:20px; color:#eee;">背景颜色<br><select name=bcolor id=bcolor onchange="javascript:document.body.style.background=this.options[this.selectedIndex].value;"><option style="background-color: #ffffff" value="#ffffff">白色</option><option style="background-color: #f6f6f6" value="#f6f6f6">银灰</option><option style="background-color: #e4ebf1" value="#e4ebf1">淡蓝</option><option style="background-color: #e6f3ff" value="#e6f3ff">蓝色</option> <option style="background-color: #eeeeee" value="#eeeeee">淡灰</option><option style="background-color: #eaeaea" value="#eaeaea">灰色</option>  <option style="background-color: #e4e1d8" value="#e4e1d8">深灰</option><option style="background-color: #e6e6e6" value="#e6e6e6">暗灰</option><option style="background-color: #eefaee" value="#eefaee">绿色</option><option style="background-color: #ffffed" value="#ffffed">明黄</option><option style="background-color: #333333" value="#333333">黑色</option></select><br>字体颜色<br><select name=txtcolor id=txtcolor onchange="javascript:document.getElementById(\'container\').style.color=this.options[this.selectedIndex].value;"> <option value="#000000">黑色</option><option value="#ff0000" style="color:red;">红色</option><option value="#006600" style="color:green;">绿色</option><option value="#0000ff" style="color:blue;">蓝色</option><option value="#660000" style="color:#006600;">棕色</option><option value="#ffffff">白色</option></select><br>字体大小<br><select name=fontsize id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontSize=this.options[this.selectedIndex].value;"> <option value="12px" >小号</option> <option value="14px" >较小</option> <option value="19px" >中号</option> <option value="19px" >默认</option><option value="22px" >较大</option><option value="25px" >大号</option><option value="35px" >35px</option><option value="45px" >45px</option><option value="55px" >55px</option><option value="65px" >65px</option><option value="75px" >75px</option><option value="85px" >85px</option><option value="95px" >95px</option></select>><br>字体类型<br><select name=fonttype id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontFamily=this.options[this.selectedIndex].value;"> <option value="宋体" >宋体</option> <option value="MV boli" style="font-family:MV boli">MV boli</option> <option value="隶书" style="font-family:隶书">隶书</option> <option value="黑体" style="font-family:黑体">黑体</option><option value="楷体" style="font-family:楷体">楷体</option><option value="幼圆" style="font-family:幼圆">幼圆</option><option value="华文中宋" style="font-family:华文中宋">华文中宋</option><option value="华文行楷" style="font-family:华文行楷">华文行楷</option><option value="微软雅黑" style="font-family:微软雅黑">微软雅黑</option><option value="Arial" style="font-family:Arial">Arial</option><option value="Vrinda" style="font-family:Vrinda">Vrinda</option><option value="Tahoma" style="font-family:Tahoma">Tahoma</option><option value="Courier" style="font-family:Courier">Courier</option><option value="Times" style="font-family:Times">Times</option><option value="Georgia" style="font-family:Georgia">Georgia</option><option value="Lucida" style="font-family:Lucida">Lucida</option></select><br><a onClick="changePage()" target="_self" id="changepage">黑底白字</a></div>');   
</script>
<style type="text/css">
#tbrowser a:linked container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:40em;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h2{
	font-size:20px;
	font-weight:bold;
	margin-top:15px;
	margin-bottom:0px;
	text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
	bottom:240px;
}
#ftsize2{
	bottom:214px;
}
#ftsize3{
	bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
pre{
	font-size:120%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	}
.code0, .code2, .code4{
	font-size:95%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	//background-color:#D9D1CA;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	background-color:#ffe;
}
.code0{
	color:red;
	text-indent:0em;
}
.code2{
	color:#930;
	text-indent:2em;
}
.code4{
	color:blue;
	text-indent:4em;
}
sub,sup{
	font-size:80%;
	color:red;
}
</style>
</head>

<body>

<div id="container">
  <p align="left"><strong>你真的理解&quot;Hello  world&quot;吗？ 从编译链接到OS内核系列专题 </strong></p>

<p>江南一散人&nbsp;2020-04-20 07:19:39</p>

<p>本文是旨在讲解编译、链接、OS内核等系统知识的系列文章的第一篇前言部分，后续会有更多精彩内容！ </p>
  <div align="center">
    <hr size="3" width="54" align="center" />
  </div>
  <p align="left">转眼间，做程序开发已经超过十年了。这么多年是眼睁睁地看着头发一天天地减少，额头一天比一天亮，脊椎越来越不好啊。 </p>
  <p align="left"><strong>个人经历和心得体会 </strong></p>

<p>这十多年间，做过OS内核开发，虚拟机，电信级的分布式集群系统，嵌入式，高性能中间件，系统性能优化等各种工作。</p>

<p><strong>时间越久，对学无止境的体会越深，越来越能理解了那句&quot;学得越多，越感到无知&quot;。</strong></p>

<p>从接触计算机软件开发开始，我就一直好奇于计算机内部的工作原理，一直有着各种各样的疑问，比如从计算机上电到看到操作系统界面，中间都做了什么事情？我们平时用C/C++、JAVA、Python等编程语言开发程序软件，那这些编程语言本身又是用怎么开发的呢？我们写的源码文本文件，是如何转变成可执行文件的？这些可执行文件又是怎么被操作系统加载执行的呢？</p>

<p>有了疑问，一定会有答案。于是，我就一直尝试着各种方法寻找这些问题的答案。可后来发现，费了九牛二虎之力搞清楚一个疑问之后，紧接着就会有第二个第三个甚至更多新的疑问出现。越深入研究，自己的疑问越多，发现自己需要学习的东西越多。</p>

<p><strong>Atlantis OS Kernel</strong></p>

<p>几年前，在尝试搞清楚一个程序究竟是如何被操作系统执行的过程中，我逐渐被操作系统内核深深吸引了。</p>

<p>为了弄清楚OS内核是如何工作的，我疯狂查阅各种书籍资料，分析内核代码，几乎达到了痴迷的程度。</p>

<p>后来，甚至在工作之余，利用晚上下班和周末时间，自己开始尝试从零实现了一个OS内核。终于，经过了大半年的努力，在查阅了大量资料，分析了Linux、VxWorks、以及国外一些大牛开发的OS内核代码之后，一个玩具级的OS内核终于开发出来了。</p>

<p>虽然只是玩具，但麻雀虽小五脏俱全，OS内核的所必备的一些基本功能都有支持，如boot、内存管理、中断管理、进程管理和调度、IPC、文件系统、磁盘驱动、键盘驱动、简单的终端等。来张截图吧：</p>

<p><img width="511" height="346" src="a_clip_image002.jpg" /></p>

<p>Atlantis Kernel 欢迎界面</p>

<p>是不是满满的VxWorks风呢  :-)</p>

<p>随后，为了研究调试器的工作原理，又在这个OS内核上实现了一个小的调试器，支持基本的断点、单步执行、反汇编、内存dump等功能。再来张图：</p>

<p><img width="640" height="434" src="a_clip_image003.jpg" alt="你真的理解'Hello world'吗？ 从编译链接到OS内核系列专题" /></p>

<p>Atlantis 调试界面</p>

<p><strong>一个编译器</strong></p>

<p>再后来，我又渐渐地迷上了编译器。为了搞清楚编译器的原理，我又开始自己动手从零开始实现了一个编译器。</p>

<p>目前已经实现了手写的词法分析器，语法分析器、语义分析、基于AST(抽象语法树)的interpreter(程序解释器)、基于寄存器的虚拟机等部件。</p>

<p>这个编译器作为一个业余项目，目前仍然在持续开发中，但是已经支持了C语言的大部分语法，还有一些我觉得比较cool的feature，如语言内置的有限状态自动机、消息通信、并行计算、定时器等针对分布式系统开发的feature。</p>

<p>还有很多feature也在计划当中，如类的支持，异常处理，JIT(Just-In-Time)，机器码生成等，等时间充裕的时候，也会逐个实现。</p>

<p>老规矩，来个&quot;Hello, World!&quot;感受一下吧：</p>

<p><img width="640" height="544" src="a_clip_image004.jpg" alt="你真的理解'Hello world'吗？ 从编译链接到OS内核系列专题" /></p>

<p>&quot;Hello, World!&quot; 示例</p>

<p>简单解释下： </p>
  <ul>
    <li>第1行 message关键字定义了一个ID为1234的消息test_msg_s，这个消息只有一个字段，是大小为32的字符数组。 </li>
    <li>第5行 automata关键字定义了一个名字为master的状态机 </li>
    <li>第7行 state关键字定义了一个名字为wait_msg的状态，一个状态机里可以有多个不同状态，状态之间可以相互迁移。这里为了简单，只定义了一个状态 </li>
    <li>第9行 input关键字表示等待接收test_msg_s的消息，一个状态里可以接收多个不同的消息，这里为了演示方便，只接收一条消息 </li>
    <li>第11行  接收到消息后，用内置函数print把消息内容打印出来 </li>
    <li>第12行 output关键字表示发送一条消息test_msg_s给名字为slave的状态机 </li>
    <li>第13行 stop关键字表示结束当前状态机，也就是master状态机 </li>
    <li>第17~27行  定义了一个名字为slave的状态机，与master状态机类似 </li>
    <li>第28~34行  定义程序入口main函数，其中第32行表示开始运行状态机 </li>
  </ul>
  <p align="left">这便是一个完整的可运行的程序了，没有任何其它的依赖。</p>

<p>整个程序很简单，就是定义两个状态机master和slave，main函数里面打印出&quot;Hello,  World!&quot;后，发一条test_msg_s给master状态机，master状态机默认处于wait_msg状态，等接收到消息后，把消息内容打印出来，然后发送一条消息给slave状态机，然后退出。同样，slave状态机收到消息把消息打印出来，然后退出。程序执行结果如下所示：</p>

<p><img width="616" height="234" src="a_clip_image005.jpg" alt="你真的理解'Hello world'吗？ 从编译链接到OS内核系列专题" /></p>

<p><strong>越是看似简单的东西，背后越不简单 </strong></p>

<p>这一路走来，我越来越体会到，<strong>越是看似简单的东西，其背后往往隐藏着非常复杂的机理</strong>。正是由于其背后这一系列强大而复杂的支持系统的存在，才使得我们在做这件事情的时候变得如此轻松简单，甚至可以不需要任何大脑思考的过程。</p>

<p><strong>越是一些如呼吸一般被我们习以为常的东西，越是容易被我们忽略，我们把它们的存在当做是理所当然，慢慢产生依赖，但一旦离开它们，我们会马上变得不适应，甚至无所适从。</strong></p>

<p>拿我们日常写代码使用的各种各样的IDE为例，现在流行的各种IDE，如Virtual Studio Code, SubText, Eclipse等，几乎无一例外，全都提供了一系列提高开发效率的辅助功能，如语法高亮、自动补全，上下文关联检索，错误检查等功能。我们对这些功能早已习以为常，认为这些都是IDE理所当然必须提供的基本功能。</p>

<p>以至于如果现在让我们去使用一个没有语法高亮，没有自动补全功能的IDE，我们便会各种不适应，甚至难以忍受。设想一下，如果现在要求你必须使用Windows记事本编写代码，你还能愉快的敲代码吗？你觉得你最多能坚持多久呢？离发疯还远吗？</p>

<p>那么，大家有没有想过，这些我们自认为的“基本功能”是如何实现的呢？这其中涉及到哪些技术？实现这些功能的难度有多大？如果要求你自己动手实现一套这样的功能，能做到吗？</p>

<p><strong>你对Hello World究竟了解多少呢？ </strong></p>

<p>同样，对于&quot;Hello, World!&quot;，我们再熟悉不过了，几乎所有人都是被它带进编程的大门的，它是如此的简单，我们甚至闭着眼睛都能写出来。但它真的就仅仅是往控制台窗口上打印一句&quot;Hello, World!&quot;字符串那么简单吗？你有没有思考过隐藏在&quot;Hello,  World!&quot;背后的那些并不为大多数人所知的技术呢？</p>

<p>不妨尝试回答下下面几个问题，看你是否能够一下子给出一个清晰明确的答案呢？ </p>
  <ul>
    <li>编译器把“Hello, World!”从C语言源码转换成可执行文件，中间经历了哪些过程？每个过程具体做了什么呢？ </li>
    <li>对于可执行文件中都有哪些内容呢？你对ELF文件格式了解多少呢？ </li>
    <li>gdb调试程序的时候，是怎么把可执行文件和源代码关联到一起的呢？ </li>
    <li>程序被加载起来之后，在内存中的布局是什么样的呢？ </li>
    <li>C语言程序的全局变量、局部变量、静态变量、函数体、参数、字符串分别是在哪里存储的呢？函数参数是怎么传递的？返回值呢？ </li>
    <li>“Hello,  World!”是怎么运行起来的呢？入口地址是什么呢？操作系统是怎么知道这个地址的呢？ </li>
    <li>C语言程序真的是从main()函数开始执行的吗？main()函数之前发生了什么？ </li>
    <li>main()函数的参数是什么吗？它的参数是谁传递过去的呢？ </li>
    <li>main()函数执行完后，程序真的就结束了吗？main()函数的返回值返回到哪里了呢？ </li>
    <li>“Hello,  World!”是怎么打印出来的呢？真的是printf()函数打印出来的吗？ </li>
    <li>你知道printf()函数的原型是什么吗？它跟普通的函数有什么区别呢？是如何实现的呢？ </li>
    <li>程序调用printf()之后究竟发生了什么？它是怎么跟OS内核联系起来的呢？ </li>
    <li>你知道动态链接库和静态链接库的区别吗？程序执行的时候，是怎么找到动态链接库里的函数呢?</li>
    <li>你能够在不中断一个程序正常执行的情况下，替换掉程序中的某个函数吗？ </li>
  </ul>
  <p align="left">对上面的问题，如果你确信能够非常清晰明确地解释清楚每个细节，那么说明你对计算机系统的基本原理和程序的执行原理已经基本掌握了。</p>

<p>如果你对其中一些问题不是很了解，或者有些东西只知其然而不知其所以然，甚至都没有想到一个简单的&quot;Hello, World!&quot;背后具体还有这么多值得思考的问题，那也不要紧。</p>

<p>接下来我会更新一系列文章，会从编译，链接、加载到程序的执行过程，从ELF文件格式到动态链接库、静态链接库，从C语言程序各要素的基本存储到操作系统内存管理，详细解析其中涉及到的每一个技术细节。力争通过这一系列专题的讲解，让你对计算机程序运行背后的隐藏机制有一个全面而清晰的理解。</p>

<p><strong>Hello World</strong><strong>背后的故事系列文章 </strong></p>

<p>计划要更新的内容，初步规划大纲如下：</p>

<p><strong>前言 (本篇)</strong></p>

<p><strong>第1章 编译器的工作原理</strong></p>

<p><strong>第2章 链接器的工作原理</strong></p>

<p><strong>第3章 深入分析ELF文件格式</strong></p>

<p><strong>第4章 动态链接库与静态链接库</strong></p>

<p><strong>第5章 程序的数据存储</strong></p>

<p><strong>第6章 函数参数、返回值的传递过程</strong></p>

<p><strong>第7章 虚拟内存</strong></p>

<p><strong>第8章 程序的加载和重定位</strong></p>

<p><strong>第9章 程序在内存中的布局</strong></p>

<p><strong>第10章 带你重新认识main()函数</strong></p>

<p><strong>第11章 从应用程序到系统调用</strong></p>

<p><strong>第12章 程序的退出和资源回收</strong></p>

<p>后续根据需要可能会进行细微调整，可能会添加新的内容。另外，有些章节涉及的知识点比较多，为了尽可能解释清楚，会分为几篇文章进行讲解。</p>

<p>我认为这些都是作为程序员必须要掌握的东西，理解了这些知识之后，会完善自己的技术知识体系，增强自己程序开发调试的能力都大有裨益。相信掌握这些知识以后，你对整个计算机技术的体系结构会有更加深刻的理解。 </p>
</div>


<div>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.4em";' target="_self" style="color:#fff;" title="大：1.4em"><div id="ftsize1" style="color:#fff;">大</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.2em";' target="_self" style="color:#fff;" title="中：1.2em"><div id="ftsize2" style="color:#fff;">中</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.0em";' target="_self" style="color:#fff;" title="小：1em"><div id="ftsize3" style="color:#fff;">小</div></a>

<a target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="goTopBtn">&and;</div></a>
<a onclick="shangy()" target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="shangy">&uarr;</div></a>
<a onclick="xiay()" target="_self" style="color:#fff;"><div id="xiay" style="color:#fff;">&darr;</div></a>
<a onclick="downn()" target="_self" style="color:#fff;"><div id="goBottom" style="color:#fff;">&or;</div></a>
<script type=text/javascript>
	goTopEx();
	function xiay(){
		window.scrollBy(0,window.innerHeight-10);
	}
	function shangy(){
		window.scrollBy(0,-window.innerHeight+10);
	}
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");
	function getHeight(){  
		if(browser4=="ch"){
			//谷歌浏览器
			return document.body.clientHeight; 
		}else{
			//IE、firefox等浏览器 
			return document.documentElement.clientHeight;  
		}  
	}
	getHeight()<window.innerHeight+50?obj3.style.display="none":obj3.style.display="";
	getHeight()<window.innerHeight+50?obj4.style.display="none":obj4.style.display="";
	if(browser4!="ch"){	//firefox需要尝一下才显示向下图标
		xiay();
		shangy();
	}
</script>
</div>

</body>
</html>

<!--
_____________________________________________________________________________________

1 段落替换
\s*</p>

<p>\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([\u4e00-\u9fa5])\s+([\u4e00-\u9fa5])
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])


------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
\s*</p>\s*
\s*<p>\s*
------------------
</p>

<p>
_____________________________________________________________________________________

4 把第和章两个字去掉
第(\S*)章
------------------
$1
_____________________________________________________________________________________

7 正则表达式参考：
https://www.toutiao.com/i6370960744082571778/
_____________________________________________________________________________________

8
<p class="picsay">
<p class="picsay">
<p class="code0">
<p class="code2">
<p class="code4">
_____________________________________________________________________________________
9 将标注序号更改为上标，红色，需一个个替换，英文html中有[1]
(\[\d\])
------------------
<sup>$1</sup>
_____________________________________________________________________________________
10 替换章不是以1-9。?！…”“结尾的段落
([^1-90。?！…”：？“章])</p>
<p>
------------------
$1
-->


