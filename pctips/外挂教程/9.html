<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<script type="text/javascript">
var userAgent = navigator.userAgent.toLowerCase();
var browser = 
	(browser = userAgent.match(/qqbrowser\/([\d.]+)/))?"qqbrowser/"+browser[1]:
	(browser = userAgent.match(/se\s+2.x/))?"sogou/2.x": //65.29%
	(browser = userAgent.match(/msie\s+([\d.]+)/))?"msie/"+browser[1]: //ie
	(browser = userAgent.match(/chrome\/([\d.]+)/))?"chrome/"+browser[1]: //chrome
	(browser = userAgent.match(/firefox\/([\d.]+)/))?"firefox/"+browser[1]: //firefox
	(browser = userAgent.match(/version\/([\d.]+)\s+safari\/([\d.]+)/))?"safari/"+browser[1]: //safari
	(browser = userAgent.match(/opera\/([\d.]+)([\w\W]+)version\/([\d.]+)/))?"opera/"+browser[3]: //opera
	"other browser";
	var browser4 = browser.substr(0,2);
//实现回到页面顶部  
function goTopEx(){  
	var obj=document.getElementById("goTopBtn"); 
	var obj2=document.getElementById("shangy"); 
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");  
	
	function getScrollTop(){  
		if(browser4=="ch"){
			//谷歌浏览器  
			return document.documentElement.scrollTop; 
		}else{
			//IE、firefox等浏览器 
			return document.documentElement.scrollTop;  
		}  
	}
	function setScrollTop(value){ 
		if(browser4=="ch"){ 
			//谷歌浏览器  
			document.documentElement.scrollTop=value; 
		}else{  
			//IE、firefox等浏览器
			document.documentElement.scrollTop=value;  
		} 
	}     
	window.onscroll=function(){getScrollTop()>50?obj.style.display="":obj.style.display="none";
	getScrollTop()>100?obj2.style.display="":obj2.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj3.style.display="":obj3.style.display="none";
	document.body.clientHeight-getScrollTop()>650?obj4.style.display="":obj4.style.display="none";
	}  
	obj.onclick=function(){  
		var goTop=setInterval(scrollMove,10);  
		function scrollMove(){  
				setScrollTop(getScrollTop()/1.1);  
				if(getScrollTop()<1)clearInterval(goTop);  
		}  
	}  
}  
function downn(){
	if(browser4=="ch"){
		//谷歌浏览器  
		window.scrollBy(0,document.body.clientHeight);
	}else{
		//IE、firefox等浏览器  
		window.scrollBy(0,document.documentElement.clientHeight*1000); 
	}
}
</script>
<script>
document.write('<div style="position:fixed; right: 10px; top:20px; color:#eee;">背景颜色<br><select name=bcolor id=bcolor onchange="javascript:document.body.style.background=this.options[this.selectedIndex].value;"><option style="background-color: #ffffff" value="#ffffff">白色</option><option style="background-color: #f6f6f6" value="#f6f6f6">银灰</option><option style="background-color: #e4ebf1" value="#e4ebf1">淡蓝</option><option style="background-color: #e6f3ff" value="#e6f3ff">蓝色</option> <option style="background-color: #eeeeee" value="#eeeeee">淡灰</option><option style="background-color: #eaeaea" value="#eaeaea">灰色</option>  <option style="background-color: #e4e1d8" value="#e4e1d8">深灰</option><option style="background-color: #e6e6e6" value="#e6e6e6">暗灰</option><option style="background-color: #eefaee" value="#eefaee">绿色</option><option style="background-color: #ffffed" value="#ffffed">明黄</option><option style="background-color: #333333" value="#333333">黑色</option></select><br>字体颜色<br><select name=txtcolor id=txtcolor onchange="javascript:document.getElementById(\'container\').style.color=this.options[this.selectedIndex].value;"> <option value="#000000">黑色</option><option value="#ff0000">红色</option><option value="#006600">绿色</option><option value="#0000ff">蓝色</option><option value="#660000">棕色</option><option value="#ffffff">白色</option></select><br>字体大小<br><select name=fonttype id=fonttype onchange="javascript:document.getElementById(\'container\').style.fontSize=this.options[this.selectedIndex].value;"> <option value="12px" >小号</option> <option value="14px" >较小</option> <option value="19px" >中号</option> <option value="19px" >默认</option><option value="22px" >较大</option><option value="25px" >大号</option><option value="35px" >35px</option><option value="45px" >45px</option><option value="55px" >55px</option><option value="65px" >65px</option><option value="75px" >75px</option><option value="85px" >85px</option><option value="95px" >95px</option></select></div>');   
</script>
<style type="text/css">
#tbrowser a:link，#container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:40em;
	line-height:1.6em;
	//overflow:hidden;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
#goTopBtn, #goBottom, #shangy, #xiay, #menuPage, #lPage, #fPage, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #menuPage, #lPage, #fPage, #ftsize1, #ftsize3{
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #lPage, #fPage, #ftsize, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#fPage{
	bottom: 236px;
	height:42px;
	white-space:nowrap;
	overflow:hidden;
	//writing-mode:tb-rl;
}
#menuPage{
	bottom: 198px;
	height:27px;
	white-space:nowrap;
	overflow:hidden;
}
#lPage{
	bottom: 145px;
	height:42px;
	white-space:nowrap;
	overflow:hidden;
}
#ftsize1{
	bottom:360px;
}
#ftsize2{
	bottom:334px;
}
#ftsize3{
	bottom:308px;
}
#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #menuPage:hover, #lPage:hover, #fPage:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #menuPage a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link, #menuPage a:visited, #lPage a:link, #fPage a:link, #lPage a:visited, #fPage a:visited {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
.lettle{
	font-size:110%;
	line-height:160%;
	
	padding:0;
	color:#930;
	text-indent:2em;
}
sub,sup{
	font-size:80%;
	color:red;
}
.layout, .layout2{
    clear:both;
	width:95%;
	border:1px dotted #eee;
	margin:auto;
	margin-bottom:5px;
	overflow:hidden;
}
.layout2 .right, .layout2 .left, .layout p{
margin-bottom:-55px;
padding-bottom:55px;
text-align: justify;
margin:0;
padding:0;
margin-left:1%;
margin-right:1%;
}
.layout2 .left, .layout p{
float:left;
width:60%;
font-size:1.0em;
}
.layout2 .right,  .layout p+p {
	float: left;
	width:34%;
	border-left:1px dotted #cccccc;
	font-size:0.9em;
	padding-left:1%;
	
}
.layout2 .right p, .layout2 .left p, .layout p{
padding-bottom:5px;
}
h2{
	font-size:1.2em;
	font-weight:bold;
	margin-top:0px;
	margin-bottom:0px;
	text-indent:0em;
	color:#990000;
	height:1.5em;
}
h3{
	text-indent:0em;
	font-size:1.2em;
	height:1.5em;
	padding:0;
	margin:0;
	color:#990000;
}
h4{
	text-indent:0em;
	font-size:1em;
	height:1.5em;
	padding:0;
	margin:0;
	color:#990000;
}
.title
{
	text-indent:0em; font-weight:bold;
	font-size:120%;
}
pre{
	font-size:120%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	margin-left:2em;
	color:blue;
	}
</style>
</head>
<body>
<div id="container">
﻿<p>【破文标题】手把手教你使用WINDBG KO XXXX游戏驱动保护</p>
<p>【破文作者】lj8888</p>
<p>【作者邮箱】xxxx@163.com</p>
<p>【作者主页】-</p>
<p>【破解工具】windbg 6.7</p>
<p>【破解平台】D版 XP SP3</p>
<p>【软件名称】</p>
<p>【软件大小】</p>
<p>【原版下载】</p>
<p>【保护方式】</p>
<p>【软件简介】当前正在内测的大型网游</p>
<p>【破解声明】菜鸟提供一点破解验证另类思路。如有失误之处纯属意外! 请高手直接飘过！</p>
<p>------------------------------------------------------------------------</p>
<p>前言： 如果你不会写驱动 不懂内核 没关系 今天 就有我来手把手教你 使用内核调式器WINDBG KO  PerfectProtector.sys</p>




<p>【破解过程】需要工具 windbg 6.7汉化版 RkUnhooker 3.7 （请自行网上下载 资源很多）</p>


<p>首先 安装后windbg 并运行它 与 RkUnhooker （无先后分别）</p>


<p>然后运行 神鬼传奇 并将它更新到最新版本 游戏运行完后 停在登陆界面</p>


<p>切换到 RkUnhooker  点 SCAN  向下看 我们看到 </p>
<p>nt!NtOpenProcess </p>
<p>nt!NtReadVirtualMemory </p>
<p>nt!NtWriteVirtualMemory</p>


<p>   01.GIF (48.97 KB)</p>


<p>2008-12-2 23:22</p>


<p>这3个函数显示 YES 表示被HOOK 记下Address地址 我们用WINDBG 去看看</p>


<p>好切换到WINDBG 菜单-打开-内核调式-本地的-确定 提示是否保存 选是</p>


<p>菜单-查看-命令浏览器  我们打入命令 uf 0xaa096314 （我这里的Address 和你的也许不同 注意看清楚！！）</p>


<p>   02.GIF (116.31 KB)</p>


<p>2008-12-2 23:22</p>


<p>aa096314 PUSH EBP                </p>
<p>aa096315 MOV EBP,ESP             </p>
<p>aa096317 ADD ESP,-28             </p>
<p>aa09631a CALL AA096091           </p>
<p>aa09631f JMP SHORT AA09633F  </p>


<p>简单浏览 CALL AA096091 非处理函数 我们直接 入命令 uf AA09633F</p>


<p>aa09633f PUSH AA096321           </p>
<p>aa096344 PUSH AA096424           </p>
<p>aa096349 PUSH AA0998D7           </p>
<p>aa09634e PUSH DWORD PTR FS:[0]   </p>
<p>aa096355 MOV FS:[0],ESP          </p>
<p>aa09635c MOV DWORD PTR [EBP-4],C0000023</p>
<p>aa096363 MOV DWORD PTR [EBP-C],0 </p>
<p>aa09636a CALL AA099D96           </p>
<p>aa09636f MOV [EBP-8],EAX         </p>
<p>aa096372 CMP DWORD PTR [EBP+8],-1</p>
<p>aa096376 JNZ SHORT AA096384      </p>
<p>aa096378 MOV DWORD PTR [EBP-C],-1</p>
<p>aa09637f JMP AA09640B            </p>
<p>aa096384 PUSH EDI                </p>
<p>aa096385 LEA EDI,[AA09ACC4]      </p>
<p>aa09638b MOV ECX,50              </p>
<p>aa096390 SHR ECX,2               </p>
<p>aa096393 MOV EAX,[EBP-8]         </p>
<p>aa096396 CLD                     </p>
<p>aa096397 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096398 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096399 POP EDI                 </p>
<p>aa09639a OR ECX,ECX              </p>
<p>aa09639c JE SHORT AA0963A0       </p>
<p>aa09639e JMP SHORT AA09640B      </p>
<p>aa0963a0 LEA EAX,[EBP-10]        </p>
<p>aa0963a3 PUSH EAX                </p>
<p>aa0963a4 PUSH 18                 </p>
<p>aa0963a6 LEA EAX,[EBP-28]        </p>
<p>aa0963a9 PUSH EAX                </p>
<p>aa0963aa PUSH 0                  </p>
<p>aa0963ac PUSH DWORD PTR [EBP+8]  </p>
<p>aa0963af CALL AA099CF4           </p>
<p>aa0963b4 OR EAX,EAX              </p>
<p>aa0963b6 JNZ SHORT AA0963C0      </p>
<p>aa0963b8 PUSH DWORD PTR [EBP-18] </p>
<p>aa0963bb POP DWORD PTR [EBP-C]   </p>
<p>aa0963be JMP SHORT AA0963D2      </p>
<p>aa0963c0 PUSH EAX                </p>
<p>aa0963c1 PUSH 1                  </p>
<p>aa0963c3 PUSH 83                 </p>
<p>aa0963c8 CALL AA093ACB           </p>
<p>aa0963cd ADD ESP,C               </p>
<p>aa0963d0 JMP SHORT AA09640B      </p>
<p>aa0963d2 CMP DWORD PTR [EBP-C],0 </p>
<p>aa0963d6 JNZ SHORT AA0963DA      </p>
<p>aa0963d8 JMP SHORT AA09640B      </p>
<p>aa0963da MOV EAX,[EBP-C]         </p>
<p>aa0963dd CMP EAX,[EBP-8]         </p>
<p>aa0963e0 JNZ SHORT AA0963E4      </p>
<p>aa0963e2 JMP SHORT AA09640B      </p>
<p>aa0963e4 PUSH ESI                </p>
<p>aa0963e5 MOV EAX,20              </p>
<p>aa0963ea SHR EAX,2               </p>
<p>aa0963ed MOV ECX,[EBP-C]         </p>
<p>aa0963f0 LEA ESI,[AA09C118]      </p>
<p>aa0963f6 JMP SHORT AA096400      </p>
<p>aa0963f8 CMP [ESI],ECX           </p>
<p>aa0963fa JE SHORT AA096404       </p>
<p>aa0963fc ADD ESI,4               </p>
<p>aa0963ff DEC EAX                 </p>
<p>aa096400 OR EAX,EAX              </p>
<p>aa096402 JNZ SHORT AA0963F8      </p>
<p>aa096404 POP ESI                 </p>
<p>aa096405 OR EAX,EAX              </p>
<p>aa096407 JE SHORT AA09640B       </p>
<p>aa096409 JMP SHORT AA096424      </p>
<p>aa09640b PUSH DWORD PTR [EBP+18] </p>
<p>aa09640e PUSH DWORD PTR [EBP+14] </p>
<p>aa096411 PUSH DWORD PTR [EBP+10] </p>
<p>aa096414 PUSH DWORD PTR [EBP+C]  </p>
<p>aa096417 PUSH DWORD PTR [EBP+8]  </p>
<p>aa09641a MOV EAX,[AA09AD1C]      </p>
<p>aa09641f CALL EAX                </p>
<p>aa096421 MOV [EBP-4],EAX         </p>
<p>aa096424 MOV EAX,[EBP-4]         </p>
<p>aa096427 POP DWORD PTR FS:[0]    </p>
<p>aa09642e ADD ESP,C               </p>
<p>aa096431 DEC DWORD PTR [AA09ADB8]</p>
<p>aa096437 LEAVE                   </p>
<p>aa096438 RETN 14                 </p>


<p>我们简单的上下看了一下  基本结构很清晰 aa09640b 这里开始 是nt!NtWriteVirtualMemory 5个参数 </p>


<p>aa09641a MOV EAX,[AA09AD1C]   应该指向原始函数地址 我们去看看</p>


<p>   03.GIF (21.28 KB)</p>


<p>2008-12-2 23:22</p>


<p>菜单-查看-内存 在Virtual中打入 AA09AD1C 看到没有 如果你看不习惯可以这样选long hex 这样很直观了吧？</p>


<p>   04.GIF (24.89 KB)</p>


<p>2008-12-2 23:22</p>


<p>805b5394 就是原始 nt!NtWriteVirtualMemory 函数地址 我们记下这个结构</p>


<p>aa09640b PUSH DWORD PTR [EBP+18] </p>
<p>aa09640e PUSH DWORD PTR [EBP+14] </p>
<p>aa096411 PUSH DWORD PTR [EBP+10] </p>
<p>aa096414 PUSH DWORD PTR [EBP+C]  </p>
<p>aa096417 PUSH DWORD PTR [EBP+8]  </p>
<p>aa09641a MOV EAX,[AA09AD1C]      </p>
<p>aa09641f CALL EAX                </p>


<p>完美调用原始函数结构 现在知道了 关键代码 下面我们在回到函数头查看 </p>


<p>aa096349 PUSH AA0998D7           </p>
<p>aa09634e PUSH DWORD PTR FS:[0]   </p>
<p>aa096355 MOV FS:[0],ESP          </p>
<p>aa09635c MOV DWORD PTR [EBP-4],C0000023 传入参数C0000023</p>
<p>aa096363 MOV DWORD PTR [EBP-C],0        传入参数0</p>
<p>aa09636a CALL AA099D96                  初步效验        </p>
<p>aa09636f MOV [EBP-8],EAX                返回值赋予局部变量</p>
<p>aa096372 CMP DWORD PTR [EBP+8],-1       比较是否-1也就是 0FFFFFFFFh</p>
<p>aa096376 JNZ SHORT AA096384             </p>
<p>aa096378 MOV DWORD PTR [EBP-C],-1</p>


<p>这里我们就直接KO它 改写aa09635c执行流程 让它直接执行到aa09640b </p>


<p>JMP aa09640b  这个怎么算的 目标地址-当前地址-5</p>


<p>好的回到内存窗口 打入aa09635c 切换为BYTE 字节查看 </p>


<p>打入E9 AA 00 00 00 好的流程被改写了 这样这个nt!NtWriteVirtualMemory函数 就被KO了 </p>


<p>   05.GIF (19.03 KB)</p>


<p>2008-12-2 23:22</p>


<p>怎么样是不是很简单？ 我们继续完成后面个函数  切换 windbg 命令窗口 </p>


<p>打入uf 0xaa0961ee 我这里的nt!NtReadVirtualMemory HOOK 地址 </p>


<p>aa0961ee PUSH EBP                </p>
<p>aa0961ef MOV EBP,ESP             </p>
<p>aa0961f1 ADD ESP,-28             </p>
<p>aa0961f4 CALL AA096091           </p>
<p>aa0961f9 JMP SHORT AA096218</p>


<p>aa096218 PUSH AA0961FB           </p>
<p>aa09621d PUSH AA0962FD           </p>
<p>aa096222 PUSH AA0998D7           </p>
<p>aa096227 PUSH DWORD PTR FS:[0]   </p>
<p>aa09622e MOV FS:[0],ESP          </p>
<p>aa096235 MOV DWORD PTR [EBP-4],C0000023</p>
<p>aa09623c MOV DWORD PTR [EBP-C],0 </p>
<p>aa096243 CALL AA099D96           </p>
<p>aa096248 MOV [EBP-8],EAX         </p>
<p>aa09624b CMP DWORD PTR [EBP+8],-1</p>
<p>aa09624f JNZ SHORT AA09625D      </p>
<p>aa096251 MOV DWORD PTR [EBP-C],-1</p>
<p>aa096258 JMP AA0962E4            </p>
<p>aa09625d PUSH EDI                </p>
<p>aa09625e LEA EDI,[AA09ACC4]      </p>
<p>aa096264 MOV ECX,50              </p>
<p>aa096269 SHR ECX,2               </p>
<p>aa09626c MOV EAX,[EBP-8]         </p>
<p>aa09626f CLD                     </p>
<p>aa096270 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096271 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096272 POP EDI                 </p>
<p>aa096273 OR ECX,ECX              </p>
<p>aa096275 JE SHORT AA096279       </p>
<p>aa096277 JMP SHORT AA0962E4      </p>
<p>aa096279 LEA EAX,[EBP-10]        </p>
<p>aa09627c PUSH EAX                </p>
<p>aa09627d PUSH 18                 </p>
<p>aa09627f LEA EAX,[EBP-28]        </p>
<p>aa096282 PUSH EAX                </p>
<p>aa096283 PUSH 0                  </p>
<p>aa096285 PUSH DWORD PTR [EBP+8]  </p>
<p>aa096288 CALL AA099CF4           </p>
<p>aa09628d OR EAX,EAX              </p>
<p>aa09628f JNZ SHORT AA096299      </p>
<p>aa096291 PUSH DWORD PTR [EBP-18] </p>
<p>aa096294 POP DWORD PTR [EBP-C]   </p>
<p>aa096297 JMP SHORT AA0962AB      </p>
<p>aa096299 PUSH EAX                </p>
<p>aa09629a PUSH 1                  </p>
<p>aa09629c PUSH 82                 </p>
<p>aa0962a1 CALL AA093ACB           </p>
<p>aa0962a6 ADD ESP,C               </p>
<p>aa0962a9 JMP SHORT AA0962E4      </p>
<p>aa0962ab CMP DWORD PTR [EBP-C],0 </p>
<p>aa0962af JNZ SHORT AA0962B3      </p>
<p>aa0962b1 JMP SHORT AA0962E4      </p>
<p>aa0962b3 MOV EAX,[EBP-C]         </p>
<p>aa0962b6 CMP EAX,[EBP-8]         </p>
<p>aa0962b9 JNZ SHORT AA0962BD      </p>
<p>aa0962bb JMP SHORT AA0962E4      </p>
<p>aa0962bd PUSH ESI                </p>
<p>aa0962be MOV EAX,20              </p>
<p>aa0962c3 SHR EAX,2               </p>
<p>aa0962c6 MOV ECX,[EBP-C]         </p>
<p>aa0962c9 LEA ESI,[AA09C118]      </p>
<p>aa0962cf JMP SHORT AA0962D9      </p>
<p>aa0962d1 CMP [ESI],ECX           </p>
<p>aa0962d3 JE SHORT AA0962DD       </p>
<p>aa0962d5 ADD ESI,4               </p>
<p>aa0962d8 DEC EAX                 </p>
<p>aa0962d9 OR EAX,EAX              </p>
<p>aa0962db JNZ SHORT AA0962D1      </p>
<p>aa0962dd POP ESI                 </p>
<p>aa0962de OR EAX,EAX              </p>
<p>aa0962e0 JE SHORT AA0962E4       </p>
<p>aa0962e2 JMP SHORT AA0962FD      </p>
<p>aa0962e4 PUSH DWORD PTR [EBP+18] </p>
<p>aa0962e7 PUSH DWORD PTR [EBP+14] </p>
<p>aa0962ea PUSH DWORD PTR [EBP+10] </p>
<p>aa0962ed PUSH DWORD PTR [EBP+C]  </p>
<p>aa0962f0 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0962f3 MOV EAX,[AA09AD18]      </p>
<p>aa0962f8 CALL EAX                </p>
<p>aa0962fa MOV [EBP-4],EAX         </p>
<p>aa0962fd MOV EAX,[EBP-4]         </p>
<p>aa096300 POP DWORD PTR FS:[0]    </p>
<p>aa096307 ADD ESP,C               </p>
<p>aa09630a DEC DWORD PTR [AA09ADB8]</p>
<p>aa096310 LEAVE                   </p>
<p>aa096311 RETN 14                 </p>


<p>是不是很眼熟啊？ 对滴 还记的哪个结构不？</p>


<p>aa0962e4 PUSH DWORD PTR [EBP+18] </p>
<p>aa0962e7 PUSH DWORD PTR [EBP+14] </p>
<p>aa0962ea PUSH DWORD PTR [EBP+10] </p>
<p>aa0962ed PUSH DWORD PTR [EBP+C]  </p>
<p>aa0962f0 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0962f3 MOV EAX,[AA09AD18]      </p>
<p>aa0962f8 CALL EAX  </p>


<p>这里也和上面一样的操作 我就直接 说结果了 改写 aa096235 JMPaa0962e4</p>


<p>在内存窗口 打入 打入E9 AA 00 00 00 （连偏移都一样 汗一个）</p>


<p>打入uf 0xaa096098 我这里的nt!NtOpenProcess HOOK 地址</p>


<p>aa096098 PUSH EBP                </p>
<p>aa096099 MOV EBP,ESP             </p>
<p>aa09609b ADD ESP,-30             </p>
<p>aa09609e CALL AA096091           </p>
<p>aa0960a3 JMP SHORT AA0960BC  </p>


<p>aa0960bc PUSH AA0960A5           </p>
<p>aa0960c1 PUSH AA0961D7           </p>
<p>aa0960c6 PUSH AA0998D7           </p>
<p>aa0960cb PUSH DWORD PTR FS:[0]   </p>
<p>aa0960d2 MOV FS:[0],ESP          </p>
<p>aa0960d9 PUSH DWORD PTR [EBP+14] </p>
<p>aa0960dc PUSH DWORD PTR [EBP+10] </p>
<p>aa0960df PUSH DWORD PTR [EBP+C]  </p>
<p>aa0960e2 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0960e5 MOV EAX,[AA09AD14]      </p>
<p>aa0960ea CALL EAX                </p>
<p>aa0960ec MOV [EBP-8],EAX         </p>
<p>aa0960ef OR EAX,EAX              </p>
<p>aa0960f1 JE SHORT AA0960F8       </p>
<p>aa0960f3 JMP AA0961D7            </p>
<p>aa0960f8 PUSH ECX                </p>
<p>aa0960f9 MOV ECX,[EBP+C]         </p>
<p>aa0960fc AND ECX,30              </p>
<p>aa0960ff OR ECX,ECX              </p>
<p>aa096101 JNZ SHORT AA096109      </p>
<p>aa096103 POP ECX                 </p>
<p>aa096104 JMP AA0961D7            </p>
<p>aa096109 POP ECX                 </p>
<p>aa09610a CALL AA099D96           </p>
<p>aa09610f MOV [EBP-C],EAX         </p>
<p>aa096112 PUSH EDI                </p>
<p>aa096113 LEA EDI,[AA09ACC4]      </p>
<p>aa096119 MOV ECX,50              </p>
<p>aa09611e SHR ECX,2               </p>
<p>aa096121 MOV EAX,[EBP-C]         </p>
<p>aa096124 CLD                     </p>
<p>aa096125 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096126 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096127 POP EDI                 </p>
<p>aa096128 OR ECX,ECX              </p>
<p>aa09612a JE SHORT AA096131       </p>
<p>aa09612c JMP AA0961D7            </p>
<p>aa096131 MOV EAX,[EBP+14]        </p>
<p>aa096134 OR EAX,EAX              </p>
<p>aa096136 JE SHORT AA09613F       </p>
<p>aa096138 MOV EAX,[EAX]           </p>
<p>aa09613a MOV [EBP-10],EAX        </p>
<p>aa09613d JMP SHORT AA096146      </p>
<p>aa09613f MOV DWORD PTR [EBP-10],0</p>
<p>aa096146 CMP DWORD PTR [EBP-10],0</p>
<p>aa09614a JNZ SHORT AA09618E      </p>
<p>aa09614c MOV EAX,[EBP+8]         </p>
<p>aa09614f PUSH DWORD PTR [EAX]    </p>
<p>aa096151 POP DWORD PTR [EBP-4]   </p>
<p>aa096154 LEA EAX,[EBP-14]        </p>
<p>aa096157 PUSH EAX                </p>
<p>aa096158 PUSH 18                 </p>
<p>aa09615a LEA EAX,[EBP-30]        </p>
<p>aa09615d PUSH EAX                </p>
<p>aa09615e PUSH 0                  </p>
<p>aa096160 PUSH DWORD PTR [EBP-4]  </p>
<p>aa096163 CALL AA099CF4           </p>
<p>aa096168 OR EAX,EAX              </p>
<p>aa09616a JNZ SHORT AA096174      </p>
<p>aa09616c PUSH DWORD PTR [EBP-20] </p>
<p>aa09616f POP DWORD PTR [EBP-10]  </p>
<p>aa096172 JMP SHORT AA096186      </p>
<p>aa096174 PUSH EAX                </p>
<p>aa096175 PUSH 1                  </p>
<p>aa096177 PUSH 81                 </p>
<p>aa09617c CALL AA093ACB           </p>
<p>aa096181 ADD ESP,C               </p>
<p>aa096184 JMP SHORT AA0961D7      </p>
<p>aa096186 CMP DWORD PTR [EBP-10],0</p>
<p>aa09618a JNZ SHORT AA09618E      </p>
<p>aa09618c JMP SHORT AA0961D7      </p>
<p>aa09618e MOV EAX,[EBP-10]        </p>
<p>aa096191 CMP EAX,[EBP-C]         </p>
<p>aa096194 JNZ SHORT AA096198      </p>
<p>aa096196 JMP SHORT AA0961D7      </p>
<p>aa096198 PUSH ESI                </p>
<p>aa096199 MOV EAX,20              </p>
<p>aa09619e SHR EAX,2               </p>
<p>aa0961a1 MOV ECX,[EBP-10]        </p>
<p>aa0961a4 LEA ESI,[AA09C118]      </p>
<p>aa0961aa JMP SHORT AA0961B4      </p>
<p>aa0961ac CMP [ESI],ECX           </p>
<p>aa0961ae JE SHORT AA0961B8       </p>
<p>aa0961b0 ADD ESI,4               </p>
<p>aa0961b3 DEC EAX                 </p>
<p>aa0961b4 OR EAX,EAX              </p>
<p>aa0961b6 JNZ SHORT AA0961AC      </p>
<p>aa0961b8 POP ESI                 </p>
<p>aa0961b9 OR EAX,EAX              </p>
<p>aa0961bb JE SHORT AA0961D7       </p>
<p>aa0961bd PUSH DWORD PTR [EBP-4]  </p>
<p>aa0961c0 CALL AA099DAE           </p>
<p>aa0961c5 MOV EAX,[EBP+8]         </p>
<p>aa0961c8 MOV DWORD PTR [EAX],0   </p>
<p>aa0961ce MOV DWORD PTR [EBP-8],C000000D</p>
<p>aa0961d5 JMP SHORT AA0961D7      </p>
<p>aa0961d7 MOV EAX,[EBP-8]         </p>
<p>aa0961da POP DWORD PTR FS:[0]    </p>
<p>aa0961e1 ADD ESP,C               </p>
<p>aa0961e4 DEC DWORD PTR [AA09ADB8]</p>
<p>aa0961ea LEAVE                   </p>
<p>aa0961eb RETN 10                 </p>


<p>这个函数有点不一样哦 我们抓住它的结构不放</p>


<p>aa0960d9 PUSH DWORD PTR [EBP+14] </p>
<p>aa0960dc PUSH DWORD PTR [EBP+10] </p>
<p>aa0960df PUSH DWORD PTR [EBP+C]  </p>
<p>aa0960e2 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0960e5 MOV EAX,[AA09AD14]      </p>
<p>aa0960ea CALL EAX                </p>


<p>nt!NtOpenProcess 的4个参数 吻合 </p>


<p>aa0960ec MOV [EBP-8],EAX         </p>
<p>aa0960ef OR EAX,EAX              </p>
<p>aa0960f1 JE SHORT AA0960F8       </p>
<p>aa0960f3 JMP AA0961D7        </p>


<p>简单分析下 返回值保存在变量 然后 或运算 想等继续处理 我们查看 aa0960f3 JMP AA0961D7 </p>


<p>不相等是如何处理</p>


<p>aa0961d7 MOV EAX,[EBP-8]         </p>
<p>aa0961da POP DWORD PTR FS:[0]    </p>
<p>aa0961e1 ADD ESP,C               </p>
<p>aa0961e4 DEC DWORD PTR [AA09ADB8]</p>
<p>aa0961ea LEAVE                   </p>
<p>aa0961eb RETN 10 </p>


<p>取出返回值 过场 这样就完了？ 那很明显 直接KO aa0960f1 2个 90 （NOP） 解决</p>


<p>到这里 驱动保护 3个函数 已经被 KO了  我们可以直接读写他的内存了 ^_^</p>


<p>本次教程结束 谢谢观看</p>
<p>------------------------------------------------------------------------</p>
<p>【破解总结】怀念一下混于ICY群内的日子 </p>


<p>内核操作请注意 保存资料 避免死机 蓝屏 损失</p>


<p>不懂的看个流程 懂的看个思路</p>
<p> </p>
<p> 【破文标题】手把手教你使用WINDBG KO XXXX游戏驱动保护</p>
<p>【破文作者】lj8888</p>
<p>【作者邮箱】xxxx@163.com</p>
<p>【作者主页】-</p>
<p>【破解工具】windbg 6.7</p>
<p>【破解平台】D版 XP SP3</p>
<p>【软件名称】</p>
<p>【软件大小】</p>
<p>【原版下载】</p>
<p>【保护方式】</p>
<p>【软件简介】当前正在内测的大型网游</p>
<p>【破解声明】菜鸟提供一点破解验证另类思路。如有失误之处纯属意外! 请高手直接飘过！</p>
<p>------------------------------------------------------------------------</p>
<p>前言： 如果你不会写驱动 不懂内核 没关系 今天 就有我来手把手教你 使用内核调式器WINDBG KO  PerfectProtector.sys</p>




<p>【破解过程】需要工具 windbg 6.7汉化版 RkUnhooker 3.7 （请自行网上下载 资源很多）</p>


<p>首先 安装后windbg 并运行它 与 RkUnhooker （无先后分别）</p>


<p>然后运行 神鬼传奇 并将它更新到最新版本 游戏运行完后 停在登陆界面</p>


<p>切换到 RkUnhooker  点 SCAN  向下看 我们看到 </p>
<p>nt!NtOpenProcess </p>
<p>nt!NtReadVirtualMemory </p>
<p>nt!NtWriteVirtualMemory</p>


<p>   01.GIF (48.97 KB)</p>


<p>2008-12-2 23:22</p>


<p>这3个函数显示 YES 表示被HOOK 记下Address地址 我们用WINDBG 去看看</p>


<p>好切换到WINDBG 菜单-打开-内核调式-本地的-确定 提示是否保存 选是</p>


<p>菜单-查看-命令浏览器  我们打入命令 uf 0xaa096314 （我这里的Address 和你的也许不同 注意看清楚！！）</p>


<p>   02.GIF (116.31 KB)</p>


<p>2008-12-2 23:22</p>


<p>aa096314 PUSH EBP                </p>
<p>aa096315 MOV EBP,ESP             </p>
<p>aa096317 ADD ESP,-28             </p>
<p>aa09631a CALL AA096091           </p>
<p>aa09631f JMP SHORT AA09633F  </p>


<p>简单浏览 CALL AA096091 非处理函数 我们直接 入命令 uf AA09633F</p>


<p>aa09633f PUSH AA096321           </p>
<p>aa096344 PUSH AA096424           </p>
<p>aa096349 PUSH AA0998D7           </p>
<p>aa09634e PUSH DWORD PTR FS:[0]   </p>
<p>aa096355 MOV FS:[0],ESP          </p>
<p>aa09635c MOV DWORD PTR [EBP-4],C0000023</p>
<p>aa096363 MOV DWORD PTR [EBP-C],0 </p>
<p>aa09636a CALL AA099D96           </p>
<p>aa09636f MOV [EBP-8],EAX         </p>
<p>aa096372 CMP DWORD PTR [EBP+8],-1</p>
<p>aa096376 JNZ SHORT AA096384      </p>
<p>aa096378 MOV DWORD PTR [EBP-C],-1</p>
<p>aa09637f JMP AA09640B            </p>
<p>aa096384 PUSH EDI                </p>
<p>aa096385 LEA EDI,[AA09ACC4]      </p>
<p>aa09638b MOV ECX,50              </p>
<p>aa096390 SHR ECX,2               </p>
<p>aa096393 MOV EAX,[EBP-8]         </p>
<p>aa096396 CLD                     </p>
<p>aa096397 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096398 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096399 POP EDI                 </p>
<p>aa09639a OR ECX,ECX              </p>
<p>aa09639c JE SHORT AA0963A0       </p>
<p>aa09639e JMP SHORT AA09640B      </p>
<p>aa0963a0 LEA EAX,[EBP-10]        </p>
<p>aa0963a3 PUSH EAX                </p>
<p>aa0963a4 PUSH 18                 </p>
<p>aa0963a6 LEA EAX,[EBP-28]        </p>
<p>aa0963a9 PUSH EAX                </p>
<p>aa0963aa PUSH 0                  </p>
<p>aa0963ac PUSH DWORD PTR [EBP+8]  </p>
<p>aa0963af CALL AA099CF4           </p>
<p>aa0963b4 OR EAX,EAX              </p>
<p>aa0963b6 JNZ SHORT AA0963C0      </p>
<p>aa0963b8 PUSH DWORD PTR [EBP-18] </p>
<p>aa0963bb POP DWORD PTR [EBP-C]   </p>
<p>aa0963be JMP SHORT AA0963D2      </p>
<p>aa0963c0 PUSH EAX                </p>
<p>aa0963c1 PUSH 1                  </p>
<p>aa0963c3 PUSH 83                 </p>
<p>aa0963c8 CALL AA093ACB           </p>
<p>aa0963cd ADD ESP,C               </p>
<p>aa0963d0 JMP SHORT AA09640B      </p>
<p>aa0963d2 CMP DWORD PTR [EBP-C],0 </p>
<p>aa0963d6 JNZ SHORT AA0963DA      </p>
<p>aa0963d8 JMP SHORT AA09640B      </p>
<p>aa0963da MOV EAX,[EBP-C]         </p>
<p>aa0963dd CMP EAX,[EBP-8]         </p>
<p>aa0963e0 JNZ SHORT AA0963E4      </p>
<p>aa0963e2 JMP SHORT AA09640B      </p>
<p>aa0963e4 PUSH ESI                </p>
<p>aa0963e5 MOV EAX,20              </p>
<p>aa0963ea SHR EAX,2               </p>
<p>aa0963ed MOV ECX,[EBP-C]         </p>
<p>aa0963f0 LEA ESI,[AA09C118]      </p>
<p>aa0963f6 JMP SHORT AA096400      </p>
<p>aa0963f8 CMP [ESI],ECX           </p>
<p>aa0963fa JE SHORT AA096404       </p>
<p>aa0963fc ADD ESI,4               </p>
<p>aa0963ff DEC EAX                 </p>
<p>aa096400 OR EAX,EAX              </p>
<p>aa096402 JNZ SHORT AA0963F8      </p>
<p>aa096404 POP ESI                 </p>
<p>aa096405 OR EAX,EAX              </p>
<p>aa096407 JE SHORT AA09640B       </p>
<p>aa096409 JMP SHORT AA096424      </p>
<p>aa09640b PUSH DWORD PTR [EBP+18] </p>
<p>aa09640e PUSH DWORD PTR [EBP+14] </p>
<p>aa096411 PUSH DWORD PTR [EBP+10] </p>
<p>aa096414 PUSH DWORD PTR [EBP+C]  </p>
<p>aa096417 PUSH DWORD PTR [EBP+8]  </p>
<p>aa09641a MOV EAX,[AA09AD1C]      </p>
<p>aa09641f CALL EAX                </p>
<p>aa096421 MOV [EBP-4],EAX         </p>
<p>aa096424 MOV EAX,[EBP-4]         </p>
<p>aa096427 POP DWORD PTR FS:[0]    </p>
<p>aa09642e ADD ESP,C               </p>
<p>aa096431 DEC DWORD PTR [AA09ADB8]</p>
<p>aa096437 LEAVE                   </p>
<p>aa096438 RETN 14                 </p>


<p>我们简单的上下看了一下  基本结构很清晰 aa09640b 这里开始 是nt!NtWriteVirtualMemory 5个参数 </p>


<p>aa09641a MOV EAX,[AA09AD1C]   应该指向原始函数地址 我们去看看</p>


<p>   03.GIF (21.28 KB)</p>


<p>2008-12-2 23:22</p>


<p>菜单-查看-内存 在Virtual中打入 AA09AD1C 看到没有 如果你看不习惯可以这样选long hex 这样很直观了吧？</p>


<p>   04.GIF (24.89 KB)</p>


<p>2008-12-2 23:22</p>


<p>805b5394 就是原始 nt!NtWriteVirtualMemory 函数地址 我们记下这个结构</p>


<p>aa09640b PUSH DWORD PTR [EBP+18] </p>
<p>aa09640e PUSH DWORD PTR [EBP+14] </p>
<p>aa096411 PUSH DWORD PTR [EBP+10] </p>
<p>aa096414 PUSH DWORD PTR [EBP+C]  </p>
<p>aa096417 PUSH DWORD PTR [EBP+8]  </p>
<p>aa09641a MOV EAX,[AA09AD1C]      </p>
<p>aa09641f CALL EAX                </p>


<p>完美调用原始函数结构 现在知道了 关键代码 下面我们在回到函数头查看 </p>


<p>aa096349 PUSH AA0998D7           </p>
<p>aa09634e PUSH DWORD PTR FS:[0]   </p>
<p>aa096355 MOV FS:[0],ESP          </p>
<p>aa09635c MOV DWORD PTR [EBP-4],C0000023 传入参数C0000023</p>
<p>aa096363 MOV DWORD PTR [EBP-C],0        传入参数0</p>
<p>aa09636a CALL AA099D96                  初步效验        </p>
<p>aa09636f MOV [EBP-8],EAX                返回值赋予局部变量</p>
<p>aa096372 CMP DWORD PTR [EBP+8],-1       比较是否-1也就是 0FFFFFFFFh</p>
<p>aa096376 JNZ SHORT AA096384             </p>
<p>aa096378 MOV DWORD PTR [EBP-C],-1</p>


<p>这里我们就直接KO它 改写aa09635c执行流程 让它直接执行到aa09640b </p>


<p>JMP aa09640b  这个怎么算的 目标地址-当前地址-5</p>


<p>好的回到内存窗口 打入aa09635c 切换为BYTE 字节查看 </p>


<p>打入E9 AA 00 00 00 好的流程被改写了 这样这个nt!NtWriteVirtualMemory函数 就被KO了 </p>


<p>   05.GIF (19.03 KB)</p>


<p>2008-12-2 23:22</p>


<p>怎么样是不是很简单？ 我们继续完成后面个函数  切换 windbg 命令窗口 </p>


<p>打入uf 0xaa0961ee 我这里的nt!NtReadVirtualMemory HOOK 地址 </p>


<p>aa0961ee PUSH EBP                </p>
<p>aa0961ef MOV EBP,ESP             </p>
<p>aa0961f1 ADD ESP,-28             </p>
<p>aa0961f4 CALL AA096091           </p>
<p>aa0961f9 JMP SHORT AA096218</p>


<p>aa096218 PUSH AA0961FB           </p>
<p>aa09621d PUSH AA0962FD           </p>
<p>aa096222 PUSH AA0998D7           </p>
<p>aa096227 PUSH DWORD PTR FS:[0]   </p>
<p>aa09622e MOV FS:[0],ESP          </p>
<p>aa096235 MOV DWORD PTR [EBP-4],C0000023</p>
<p>aa09623c MOV DWORD PTR [EBP-C],0 </p>
<p>aa096243 CALL AA099D96           </p>
<p>aa096248 MOV [EBP-8],EAX         </p>
<p>aa09624b CMP DWORD PTR [EBP+8],-1</p>
<p>aa09624f JNZ SHORT AA09625D      </p>
<p>aa096251 MOV DWORD PTR [EBP-C],-1</p>
<p>aa096258 JMP AA0962E4            </p>
<p>aa09625d PUSH EDI                </p>
<p>aa09625e LEA EDI,[AA09ACC4]      </p>
<p>aa096264 MOV ECX,50              </p>
<p>aa096269 SHR ECX,2               </p>
<p>aa09626c MOV EAX,[EBP-8]         </p>
<p>aa09626f CLD                     </p>
<p>aa096270 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096271 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096272 POP EDI                 </p>
<p>aa096273 OR ECX,ECX              </p>
<p>aa096275 JE SHORT AA096279       </p>
<p>aa096277 JMP SHORT AA0962E4      </p>
<p>aa096279 LEA EAX,[EBP-10]        </p>
<p>aa09627c PUSH EAX                </p>
<p>aa09627d PUSH 18                 </p>
<p>aa09627f LEA EAX,[EBP-28]        </p>
<p>aa096282 PUSH EAX                </p>
<p>aa096283 PUSH 0                  </p>
<p>aa096285 PUSH DWORD PTR [EBP+8]  </p>
<p>aa096288 CALL AA099CF4           </p>
<p>aa09628d OR EAX,EAX              </p>
<p>aa09628f JNZ SHORT AA096299      </p>
<p>aa096291 PUSH DWORD PTR [EBP-18] </p>
<p>aa096294 POP DWORD PTR [EBP-C]   </p>
<p>aa096297 JMP SHORT AA0962AB      </p>
<p>aa096299 PUSH EAX                </p>
<p>aa09629a PUSH 1                  </p>
<p>aa09629c PUSH 82                 </p>
<p>aa0962a1 CALL AA093ACB           </p>
<p>aa0962a6 ADD ESP,C               </p>
<p>aa0962a9 JMP SHORT AA0962E4      </p>
<p>aa0962ab CMP DWORD PTR [EBP-C],0 </p>
<p>aa0962af JNZ SHORT AA0962B3      </p>
<p>aa0962b1 JMP SHORT AA0962E4      </p>
<p>aa0962b3 MOV EAX,[EBP-C]         </p>
<p>aa0962b6 CMP EAX,[EBP-8]         </p>
<p>aa0962b9 JNZ SHORT AA0962BD      </p>
<p>aa0962bb JMP SHORT AA0962E4      </p>
<p>aa0962bd PUSH ESI                </p>
<p>aa0962be MOV EAX,20              </p>
<p>aa0962c3 SHR EAX,2               </p>
<p>aa0962c6 MOV ECX,[EBP-C]         </p>
<p>aa0962c9 LEA ESI,[AA09C118]      </p>
<p>aa0962cf JMP SHORT AA0962D9      </p>
<p>aa0962d1 CMP [ESI],ECX           </p>
<p>aa0962d3 JE SHORT AA0962DD       </p>
<p>aa0962d5 ADD ESI,4               </p>
<p>aa0962d8 DEC EAX                 </p>
<p>aa0962d9 OR EAX,EAX              </p>
<p>aa0962db JNZ SHORT AA0962D1      </p>
<p>aa0962dd POP ESI                 </p>
<p>aa0962de OR EAX,EAX              </p>
<p>aa0962e0 JE SHORT AA0962E4       </p>
<p>aa0962e2 JMP SHORT AA0962FD      </p>
<p>aa0962e4 PUSH DWORD PTR [EBP+18] </p>
<p>aa0962e7 PUSH DWORD PTR [EBP+14] </p>
<p>aa0962ea PUSH DWORD PTR [EBP+10] </p>
<p>aa0962ed PUSH DWORD PTR [EBP+C]  </p>
<p>aa0962f0 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0962f3 MOV EAX,[AA09AD18]      </p>
<p>aa0962f8 CALL EAX                </p>
<p>aa0962fa MOV [EBP-4],EAX         </p>
<p>aa0962fd MOV EAX,[EBP-4]         </p>
<p>aa096300 POP DWORD PTR FS:[0]    </p>
<p>aa096307 ADD ESP,C               </p>
<p>aa09630a DEC DWORD PTR [AA09ADB8]</p>
<p>aa096310 LEAVE                   </p>
<p>aa096311 RETN 14                 </p>


<p>是不是很眼熟啊？ 对滴 还记的哪个结构不？</p>


<p>aa0962e4 PUSH DWORD PTR [EBP+18] </p>
<p>aa0962e7 PUSH DWORD PTR [EBP+14] </p>
<p>aa0962ea PUSH DWORD PTR [EBP+10] </p>
<p>aa0962ed PUSH DWORD PTR [EBP+C]  </p>
<p>aa0962f0 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0962f3 MOV EAX,[AA09AD18]      </p>
<p>aa0962f8 CALL EAX  </p>


<p>这里也和上面一样的操作 我就直接 说结果了 改写 aa096235 JMPaa0962e4</p>


<p>在内存窗口 打入 打入E9 AA 00 00 00 （连偏移都一样 汗一个）</p>


<p>打入uf 0xaa096098 我这里的nt!NtOpenProcess HOOK 地址</p>


<p>aa096098 PUSH EBP                </p>
<p>aa096099 MOV EBP,ESP             </p>
<p>aa09609b ADD ESP,-30             </p>
<p>aa09609e CALL AA096091           </p>
<p>aa0960a3 JMP SHORT AA0960BC  </p>


<p>aa0960bc PUSH AA0960A5           </p>
<p>aa0960c1 PUSH AA0961D7           </p>
<p>aa0960c6 PUSH AA0998D7           </p>
<p>aa0960cb PUSH DWORD PTR FS:[0]   </p>
<p>aa0960d2 MOV FS:[0],ESP          </p>
<p>aa0960d9 PUSH DWORD PTR [EBP+14] </p>
<p>aa0960dc PUSH DWORD PTR [EBP+10] </p>
<p>aa0960df PUSH DWORD PTR [EBP+C]  </p>
<p>aa0960e2 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0960e5 MOV EAX,[AA09AD14]      </p>
<p>aa0960ea CALL EAX                </p>
<p>aa0960ec MOV [EBP-8],EAX         </p>
<p>aa0960ef OR EAX,EAX              </p>
<p>aa0960f1 JE SHORT AA0960F8       </p>
<p>aa0960f3 JMP AA0961D7            </p>
<p>aa0960f8 PUSH ECX                </p>
<p>aa0960f9 MOV ECX,[EBP+C]         </p>
<p>aa0960fc AND ECX,30              </p>
<p>aa0960ff OR ECX,ECX              </p>
<p>aa096101 JNZ SHORT AA096109      </p>
<p>aa096103 POP ECX                 </p>
<p>aa096104 JMP AA0961D7            </p>
<p>aa096109 POP ECX                 </p>
<p>aa09610a CALL AA099D96           </p>
<p>aa09610f MOV [EBP-C],EAX         </p>
<p>aa096112 PUSH EDI                </p>
<p>aa096113 LEA EDI,[AA09ACC4]      </p>
<p>aa096119 MOV ECX,50              </p>
<p>aa09611e SHR ECX,2               </p>
<p>aa096121 MOV EAX,[EBP-C]         </p>
<p>aa096124 CLD                     </p>
<p>aa096125 REPNE SCAS BYTE PTR ES:[EDI]</p>
<p>aa096126 SCAS DWORD PTR ES:[EDI] </p>
<p>aa096127 POP EDI                 </p>
<p>aa096128 OR ECX,ECX              </p>
<p>aa09612a JE SHORT AA096131       </p>
<p>aa09612c JMP AA0961D7            </p>
<p>aa096131 MOV EAX,[EBP+14]        </p>
<p>aa096134 OR EAX,EAX              </p>
<p>aa096136 JE SHORT AA09613F       </p>
<p>aa096138 MOV EAX,[EAX]           </p>
<p>aa09613a MOV [EBP-10],EAX        </p>
<p>aa09613d JMP SHORT AA096146      </p>
<p>aa09613f MOV DWORD PTR [EBP-10],0</p>
<p>aa096146 CMP DWORD PTR [EBP-10],0</p>
<p>aa09614a JNZ SHORT AA09618E      </p>
<p>aa09614c MOV EAX,[EBP+8]         </p>
<p>aa09614f PUSH DWORD PTR [EAX]    </p>
<p>aa096151 POP DWORD PTR [EBP-4]   </p>
<p>aa096154 LEA EAX,[EBP-14]        </p>
<p>aa096157 PUSH EAX                </p>
<p>aa096158 PUSH 18                 </p>
<p>aa09615a LEA EAX,[EBP-30]        </p>
<p>aa09615d PUSH EAX                </p>
<p>aa09615e PUSH 0                  </p>
<p>aa096160 PUSH DWORD PTR [EBP-4]  </p>
<p>aa096163 CALL AA099CF4           </p>
<p>aa096168 OR EAX,EAX              </p>
<p>aa09616a JNZ SHORT AA096174      </p>
<p>aa09616c PUSH DWORD PTR [EBP-20] </p>
<p>aa09616f POP DWORD PTR [EBP-10]  </p>
<p>aa096172 JMP SHORT AA096186      </p>
<p>aa096174 PUSH EAX                </p>
<p>aa096175 PUSH 1                  </p>
<p>aa096177 PUSH 81                 </p>
<p>aa09617c CALL AA093ACB           </p>
<p>aa096181 ADD ESP,C               </p>
<p>aa096184 JMP SHORT AA0961D7      </p>
<p>aa096186 CMP DWORD PTR [EBP-10],0</p>
<p>aa09618a JNZ SHORT AA09618E      </p>
<p>aa09618c JMP SHORT AA0961D7      </p>
<p>aa09618e MOV EAX,[EBP-10]        </p>
<p>aa096191 CMP EAX,[EBP-C]         </p>
<p>aa096194 JNZ SHORT AA096198      </p>
<p>aa096196 JMP SHORT AA0961D7      </p>
<p>aa096198 PUSH ESI                </p>
<p>aa096199 MOV EAX,20              </p>
<p>aa09619e SHR EAX,2               </p>
<p>aa0961a1 MOV ECX,[EBP-10]        </p>
<p>aa0961a4 LEA ESI,[AA09C118]      </p>
<p>aa0961aa JMP SHORT AA0961B4      </p>
<p>aa0961ac CMP [ESI],ECX           </p>
<p>aa0961ae JE SHORT AA0961B8       </p>
<p>aa0961b0 ADD ESI,4               </p>
<p>aa0961b3 DEC EAX                 </p>
<p>aa0961b4 OR EAX,EAX              </p>
<p>aa0961b6 JNZ SHORT AA0961AC      </p>
<p>aa0961b8 POP ESI                 </p>
<p>aa0961b9 OR EAX,EAX              </p>
<p>aa0961bb JE SHORT AA0961D7       </p>
<p>aa0961bd PUSH DWORD PTR [EBP-4]  </p>
<p>aa0961c0 CALL AA099DAE           </p>
<p>aa0961c5 MOV EAX,[EBP+8]         </p>
<p>aa0961c8 MOV DWORD PTR [EAX],0   </p>
<p>aa0961ce MOV DWORD PTR [EBP-8],C000000D</p>
<p>aa0961d5 JMP SHORT AA0961D7      </p>
<p>aa0961d7 MOV EAX,[EBP-8]         </p>
<p>aa0961da POP DWORD PTR FS:[0]    </p>
<p>aa0961e1 ADD ESP,C               </p>
<p>aa0961e4 DEC DWORD PTR [AA09ADB8]</p>
<p>aa0961ea LEAVE                   </p>
<p>aa0961eb RETN 10                 </p>


<p>这个函数有点不一样哦 我们抓住它的结构不放</p>


<p>aa0960d9 PUSH DWORD PTR [EBP+14] </p>
<p>aa0960dc PUSH DWORD PTR [EBP+10] </p>
<p>aa0960df PUSH DWORD PTR [EBP+C]  </p>
<p>aa0960e2 PUSH DWORD PTR [EBP+8]  </p>
<p>aa0960e5 MOV EAX,[AA09AD14]      </p>
<p>aa0960ea CALL EAX                </p>


<p>nt!NtOpenProcess 的4个参数 吻合 </p>


<p>aa0960ec MOV [EBP-8],EAX         </p>
<p>aa0960ef OR EAX,EAX              </p>
<p>aa0960f1 JE SHORT AA0960F8       </p>
<p>aa0960f3 JMP AA0961D7        </p>


<p>简单分析下 返回值保存在变量 然后 或运算 想等继续处理 我们查看 aa0960f3 JMP AA0961D7 </p>


<p>不相等是如何处理</p>


<p>aa0961d7 MOV EAX,[EBP-8]         </p>
<p>aa0961da POP DWORD PTR FS:[0]    </p>
<p>aa0961e1 ADD ESP,C               </p>
<p>aa0961e4 DEC DWORD PTR [AA09ADB8]</p>
<p>aa0961ea LEAVE                   </p>
<p>aa0961eb RETN 10 </p>


<p>取出返回值 过场 这样就完了？ 那很明显 直接KO aa0960f1 2个 90 （NOP） 解决</p>


<p>到这里 驱动保护 3个函数 已经被 KO了  我们可以直接读写他的内存了 ^_^</p>


<p>本次教程结束 谢谢观看</p>
<p>------------------------------------------------------------------------</p>
<p>【破解总结】怀念一下混于ICY群内的日子 </p>


<p>内核操作请注意 保存资料 避免死机 蓝屏 损失</p>


<p>不懂的看个流程 懂的看个思路</p>
﻿
</div>
<div>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.4em";' target="_self" style="color:#fff;" title="大：1.4em"><div id="ftsize1" style="color:#fff;">大</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.2em";' target="_self" style="color:#fff;" title="中：1.2em"><div id="ftsize2" style="color:#fff;">中</div></a>
<a id="ftsizea" onclick='document.getElementById("container").style.fontSize = "1.0em";' target="_self" style="color:#fff;" title="小：1em"><div id="ftsize3" style="color:#fff;">小</div></a>
<a id="fPagea" href="index.html" target="_self"><div id="fPage" style="color:#fff;">上<br>一<br>章</div></a>
<a href="index.html" target="_self"><div id="menuPage" style="color:#fff;">目<br>录</div></a>
<a id="LPagea" href="javascript:void(null)" target="_self"><div id="lPage" style="color:#fff;">下<br>一<br>章</div></a>
<a target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="goTopBtn">&and;</div></a>
<a onclick="shangy()" target="_self" style="color:#fff;"><div style="display:none; color:#fff;" id="shangy">&uarr;</div></a>
<a onclick="xiay()" target="_self" style="color:#fff;"><div id="xiay" style="color:#fff;">&darr;</div></a>
<a onclick="downn()" target="_self" style="color:#fff;"><div id="goBottom" style="color:#fff;">&or;</div></a>
<script type=text/javascript>
	goTopEx();
	function xiay(){
		window.scrollBy(0,window.innerHeight-10);
	}
	function shangy(){
		window.scrollBy(0,-window.innerHeight+10);
	}
	var obj3=document.getElementById("xiay");
	var obj4=document.getElementById("goBottom");
	function getHeight(){  
		if(browser4=="ch"){
			//谷歌浏览器  
			return document.body.clientHeight; 
		}else{
			//IE、firefox等浏览器 
			return document.documentElement.clientHeight;  
		}  
	}
	getHeight()<window.innerHeight+50?obj3.style.display="none":obj3.style.display="";
	getHeight()<window.innerHeight+50?obj4.style.display="none":obj4.style.display="";
	if(browser4!="ch"){	//firefox需要尝一下才显示向下图标
		xiay();
		shangy();
	}
	//上一页、下一页按钮，需要文件名是数字
	var strUrl=window.location.href;
	var arrUrl=strUrl.split("/");
	var thispage=arrUrl[arrUrl.length-1];
	var thispage2=thispage.split(".");
	var thispage3=thispage2[thispage2.length-2];
	if(thispage3 == 0){
		var obj5=document.getElementById("fPage");
		obj5.style.display="none";
	}else{
		var fpage = thispage3 - 1;
		fpage = fpage +".html";
		document.getElementById("fPagea").href=fpage;
	}
	if(thispage3 == 31){
		var obj6=document.getElementById("lPage");
		obj6.style.display="none";
	}else{
		var fpage = parseInt(thispage3) + 1;
		fpage = fpage +".html";
		document.getElementById("LPagea").href=fpage;
	}
</script>
</div>
</body>
</html>
