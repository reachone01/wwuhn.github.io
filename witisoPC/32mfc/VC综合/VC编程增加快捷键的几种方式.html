<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
function goTopEx(){
	var obj=document.getElementById("goTopBtn");
	function getScrollTop(){
			return document.documentElement.scrollTop;
		}
	function setScrollTop(value){
			document.documentElement.scrollTop=value;
		}    
	window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
	obj.onclick=function(){
		var goTop=setInterval(scrollMove,10);
		function scrollMove(){
				setScrollTop(getScrollTop()/111);
				if(getScrollTop()<1)clearInterval(goTop);
			}
	}
}

 
 function goTopEx(){
        var obj=document.getElementById("goTopBtn");
        function getScrollTop(){
                return document.documentElement.scrollTop;
            }
        function setScrollTop(value){
                document.documentElement.scrollTop=value;
            }    
        window.onscroll=function(){getScrollTop()>0?obj.style.display="":obj.style.display="none";}
        obj.onclick=function(){
            var goTop=setInterval(scrollMove,10);
            function scrollMove(){
                    setScrollTop(getScrollTop()/111);
                    if(getScrollTop()<1)clearInterval(goTop);
                }
        }
    }


</script>
<title>VC编程增加快捷键的几种方式 </title>

<style type="text/css">
#tbrowser a:linked container a:visited{
	font-size:18px;
	text-decoration:none;
}
a:link{
	text-decoration:none;
	}
#container{
	font-size:1.2em;
	margin:auto;
	font-family:"宋体";
	width:40em;
	line-height:1.6em;
}
P{
	margin-top:16px;
	margin-bottom:16px;
	text-indent:2em;
}
.uls{
	color:#CC6666;
	font-weight:bold;
}
.uls>ol{
	list-style:none;
	font-weight:normal;
	list-style:lower-latin;
	color:#000000;
	line-height:1.3em;
}
h3{
	font-size:1.1em;
	font-weight:bold;
	text-indent:0em;
	color:#990000;
}
h4{
	font-size:1.0em;
	font-weight:bold;
	text-indent:0em;
}

#goTopBtn, #goBottom, #shangy, #xiay, #ftsize1, #ftsize2, #ftsize3{
	width: 18px;
    line-height: 1.2;
    padding: 5px 0;
    font-size: 12px;
    text-align: center;
    position: fixed;
	right: 10px;
    cursor: pointer;
    filter: Alpha(opacity=30);
	opacity=.3;
	font-weight:bold;
}
#goTopBtn, #goBottom, #ftsize1, #ftsize3  {
    background-color:#999;
    color:#000;
}
#shangy, #xiay, #ftsize2{
    background-color: #bbb;
    color: #000;
}
#ftsize1{
	bottom:240px;
}
#ftsize2{
	bottom:214px;
}
#ftsize3{
	bottom:188px;
}

#goTopBtn{
    bottom: 105px;
}
#goBottom {
    bottom: 30px;
}
#shangy {
    bottom: 80px;
}
#xiay {
    bottom: 55px;
}
#goTopBtn:hover, #goBottom:hover, #shangy:hover, #xiay:hover, #ftsize1:hover, #ftsize2:hover, #ftsize3:hover{
	background-color:#ccc;
	border:#ccc 0px solid;
}
#goTopBtn a:link, #goBottom a:link, #xiay a:link, #shangy a:link, #ftsize1 a:link, #ftsize2 a:link, #ftsize3 a:link {
	text-decoration: none;
	color:white;
}
img{
	margin-right:2em;
	text-indent:2em;
	border:0;
}
.picsay{
	color:#930;
	font-size:90%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
}
.remark{
	color:#930;
	font-size:90%;
	line-height:140%;
	margin-top:-12px;
	text-indent:0em;
	padding:0;
}
.ref{
	color:#930;
	font-size:95%;
	line-height:150%;
	margin-top:-12px;
	text-indent:2em;
	padding:0;
}
pre{
	font-size:120%;
	line-height:130%;
	padding:0;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	//background-color:#ffe;
	background-color:#eee;
	padding:8px;
	}
.code0, .code2, .code4{
	font-size:95%;
	line-height:110%;
	margin-top:-12px;
	padding:0;
	//background-color:#D9D1CA;
	//background-color:#f6f6f6;
	//background-color:#fff5ee;
	background-color:#ffe;
}
.code0{
	color:red;
	text-indent:0em;
}
.code2{
	color:#930;
	text-indent:2em;
}
.code4{
	color:blue;
	text-indent:4em;
}
sub,sup{
	font-size:80%;
	color:red;
}
</style>
</head>

<body>

<div id="container">
<p>定义快捷方式有下面几种方法:</p>

<h4>1 对于菜单(MENU)或者按钮(BUTTON)</h4>

<p>直接在菜单或按钮的标题中，包含&amp;X即可，这里X是任意字符键</p>

<p>示例：Tool菜单项的标题可以写作:&quot;&amp;Tool&quot;或者&quot;工具(&amp;T)&quot;，这样就可以直接用ALT+T直接调用该菜单项的功能</p>
<h4>2 对菜单(MENU)</h4>

<p>菜单的另一种快捷键的定义方式是组合键或者虚拟键，如Ctrl+O表示打开文件,或F5表示运行等</p>

<p>示例: 在File菜单项的Open字菜单项的标题可以写作:&quot;&amp;Open\tCtrl+O&quot;,这样我们既可以用ALT+O或Ctrl+O来直接调用菜单项的功能</p>
<h4>3 另一种方式定义快捷键的就是自定义加速键</h4>

<p>首先在资源文件Accelerator中添加快捷键资源 ID选择你要关联菜单项的名称然后再设置你的快捷键</p>

<p>在.h文件中加入一个HACCEL hAccel;</p>

<p>变量然后在OnInitDialog或初始化中加入   hAccel=::LoadAccelerators(AfxGetInstanceHandle(),MAKEINTRESOURCE(IDR_MENU_MAIN));   IDR_MENU_MAIN为加速键的资源文件名</p>

<p>最后在PreTranslateMessage(MSG* pMsg) 中加入:</p>

<p class="picsay">if(::TranslateAccelerator(GetSafeHwnd(),hAccel,pMsg))</p>

<p class="picsay">return true;</p>
<p>这样以后只要在Accelerator资源文件中添加快捷键就可以了</p>

<p>注意：添加快捷键的名字一定要与菜单名称一样 这样才能响应.现在只需要在此菜单项中加入OnCommand消息的处理就可以了.</p>

<h4>4 第二种自定义加速键的方法</h4>

<p>还是在资源文件Accelerator中添加快捷键资源 ID自己定义一个.然后再设置你的快捷键.</p>

<p>在.h文件中定义一个快捷键对象HACCEL m_hAccel;</p>

<p>变量然后在OnInitDialog或初始化中加入   hAccel=::LoadAccelerators(AfxGetInstanceHandle(),MAKEINTRESOURCE(IDR_MENU_MAIN));   IDR_MENU_MAIN为加速键的资源文件名</p>

<p>再添加PreTranslateMessage消息处理 在里面加入以下代码:</p>
<pre>
if(m_hAccel != NULL)
{
    if (TranslateAccelerator(m_hWnd, m_hAccel, pMsg))
        return TRUE;
}
</pre>
<p>再添加OnCommand消息处理 加入以下代码:</p>
<pre>
// 响应加速键
switch(LOWORD(wParam))
{
case SHOW_DIAL0G: //加速键ID
    //...添加处理语句
    break;
case SHOW_DIALOG_02: //加速键ID
    //...添加处理语句
    break;
}
</pre>
<p>这种方式可以任意调用加速键 </p>
<p></p>

<h4>5.菜单添加全局快捷键，以对话框程序为例：</h4>
<p> 在OnInitDialog中添加注册热键的代码：</p>

<p>RegisterHotKey(GetSafeHwnd(),1001,NULL,VK_F2);//F2键</p>

<p>RegisterHotKey(GetSafeHwnd(),1002,MOD_ALT,'1');//Alt+1键</p>

<p>在</p>

<p>BEGIN_MESSAGE_MAP(CXXXDlg, CDialog)</p>

<p>...</p>

<p>END_MESSAGE_MAP()</p>

<p>中添加WM_HOTKEY的消息映射：</p>

<p>ON_MESSAGE(WM_HOTKEY,&amp;CXXXDlg::OnHotKey)//快捷键消息映射手动加入</p>

<p>在头文件中添加OnHotKey的声明：</p>

<pre>
protected:
    afx_msg LRESULT OnHotKey(WPARAM wParam,LPARAM lParam);//手动加入.
    CPP中OnHotKey的实现代码：
        //相应快捷键的消息映射
    LRESULT CXXXDlg::OnHotKey(WPARAM wParam,LPARAM lParam)
    {
        if(wParam ==1001)
        {
            MessageBox("热键F2已经按下！");
            //这里可以加上你按钮要执行的操作，或者直接调用按钮映射的消息函数
        }
        else if (wParam==1002)
        {
            MessageBox("热键ALT+1已经按下！");
        }
        return 0;
    }
</pre>

<p>关闭对话框时使用</p>

<p>UnregisterHotKey(GetSafeHwnd(),1001);//注销F2键</p>

<p>UnregisterHotKey(GetSafeHwnd(),1002);//注销Alt+1键注销热键.</p>
<h4>7 按钮ctrl快捷键</h4>
<p>我们可以这样想，我们截取用户的F按键，如果用户按了F按键的话，判断一下ctr键是否被按下，如果被按下的话，说明用户按了CTR + F ，然后我们去调相应的按钮事件就可以了。</p>
<p>我们需要覆写CDialog类的 PreTranslateMessage(MSG* pMsg)；这是一个虚方法。</p>
<p>代码如下：</p>
<pre>
BOOL TextBox::PreTranslateMessage(MSG* pMsg) 
{    
    if (pMsg-> message== WM_KEYDOWN)              // 先判断是否是键盘输入消息
	{
        int nkeyDown =  pMsg->wParam;        
        BOOL bkeyState = GetKeyState(VK_CONTROL); // ctr键的状态获取
		//BOOL bAltkeyState = GetKeyState(VK_MENU); 
        if (nkeyDown == 83 && bkeyState)          // 83表示S，要使用大写的ASCII
		{
            OnButton52();                         // 内容保存到origianl.txt
        }
    }
	return CDialog::PreTranslateMessage(pMsg);
}
</pre>
<p>我发现失败了，按alt+F根本不会进入if(pMsg->message==WM_KEYDOWN){}这个块里。查了许多资料，发现alt很特殊，它的宏定义是</p>
<p>VK_MENU，其实它是MENU菜单的快捷键。</p>
<p>alt+F是不是就实现不了呢？不是的，是可以实现的，这就是加快捷键的第二种方法。</p>
<p>我们可以用加速键表来添加快加键。</p>
<p>打开资源视图，新建Accelerator资源。加入ALT+F快捷键。</p>


<p>这里的ID就是相应按钮的ID。定义一个成员变量HACCEL m_hAccel;</p>
<p>在OnInitDialog()方法里进行初始化：</p>
<p></p>

<pre>
m_hAccel = LoadAccelerators(AfxGetResourceHandle(), MAKEINTRESOURCE(IDR_ACCELERATOR1));

BOOL CXXXDlg::PreTranslateMessage(MSG* pMsg)
{
    if (WM_KEYFIRST &lt;= pMsg->message && pMsg->message &lt;= WM_KEYLAST) 
    { 
        HACCEL hAccel = m_hAccel; 
        if (hAccel && ::TranslateAccelerator(m_hWnd, hAccel, pMsg)) 
            return TRUE; 
    } 
    return CDialog::PreTranslateMessage(pMsg);
}
</pre>




<br />
<br />
<br />

</div>
<a name="bottom" id="bottom"></a>
<DIV style="DISPLAY: none" id=goTopBtn>&and;</DIV>
<div id="goBottom"><a href="#bottom" target="_self">&or;</a></div>
<SCRIPT type=text/javascript>goTopEx();</SCRIPT>
</body>
</html>
<script language="javascript"> 
bg_evensssss("tbrowser","#fff","#F5F5F5","#FFFFCC","#FFDDFF");/*#FFFF84*/
</script>

<!--
_____________________________________________________________________________________

1 段落替换：
\s*</p>

<p>\s*
------------------
</p>

<p>
_____________________________________________________________________________________
2 汉字中间的空格替换：
([^\s\*^{}"^u4e00-u9fa5])\s+([^\s\*^{}"^u4e00-u9fa5])
------------------
$1$2
_____________________________________________________________________________________
3 段落前的空格替换
[\s*</p>\s*]
[\s*<p>\s*]
------------------
</p>

<p>
_____________________________________________________________________________________
-->